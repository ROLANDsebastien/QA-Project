# FM Compta Consulting - Automated QA Project

This project demonstrates a full-stack application (Next.js Frontend, Node.js Backend, MongoDB Database) with an automated QA pipeline using Docker Compose for local simplicity, and ready for Kubernetes deployment in production.

## Quick Start

1. **Clone the project:**
   ```bash
   git clone <repo-url>
   cd qa-project
   ```

2. **Start the QA environment:**
   ```bash
   make qa-start
   ```
   This launches all containers (app + QA tools) and displays the dashboard at `http://localhost:8080`.

3. **Run automated tests:**
   ```bash
   make qa-test
   ```
   Results are automatically retrieved and displayed in the dashboard.

4. **Stop the environment:**
   ```bash
   make qa-stop
   ```

### Why Makefile?
Makefile is chosen for its simplicity and cross-platform compatibility in automating common development tasks. It allows running commands like `make qa-start` or `make qa-test` without remembering complex Docker Compose or script invocations, making the workflow more efficient and reproducible across different environments.

## Included QA Tools

- **ESLint**: Code quality analysis
- **Selenium**: User interface tests
- **k6**: Load testing
- **Centralized Dashboard**: Summary of results at `http://localhost:8080`

## Production Deployment (Kubernetes)

Although the local demo uses Docker Compose for simplicity, the project is ready for Kubernetes via k3s or any K8s cluster. Note that Kubernetes deployment is currently in development and will be fully implemented in future updates.

Manifests are in `qa/kubernetes/deployment.yaml`. To deploy:

```bash
kubectl apply -f qa/kubernetes/deployment.yaml
```

This deploys the full application with QA tools.

## Project Structure

- `fm-compta-consulting-backend/`: Backend API
- `fm-compta-consulting-frontend/`: Frontend Interface
- `fm-compta-consulting-database/`: MongoDB Configuration
- `qa/`: QA scripts and configurations
  - `dashboard/`: Dashboard web page
  - `kubernetes/`: K8s manifests
  - `run_tests.sh`: Test automation script
  - `selenium_tests.py`: Selenium tests
  - `k6_script.js`: k6 load tests

## Demonstrated Skills

- Full-stack development (Next.js, Node.js, MongoDB)
- Containerization (Docker, Docker Compose)
- Automated testing (QA, CI/CD)
- Orchestration (Kubernetes)
- Automation and scripting

## Backend API

This is the backend API for FM Compta Consulting, built with Node.js, Express, and TypeScript.

### Technologies Used

- Node.js (v18+ or v20+)
- Express
- TypeScript
- MongoDB (via Mongoose)
- JSON Web Tokens (JWT) for authentication
- ESLint / Prettier (Linting / Formatting)

### Project Structure (Example)

```
backend/
├── dist/              # Compiled JavaScript code (generated by `npm run build`)
├── src/
│   ├── config/        # Configuration (e.g., DB connection, secrets)
│   ├── controllers/    # Request/response HTTP logic
│   ├── middleware/    # Express middleware (e.g., authentication, validation)
│   ├── models/        # Mongoose schemas and models
│   ├── routes/        # API route definitions
│   ├── services/      # Business logic, interaction with models
│   ├── types/         # Custom TypeScript type definitions
│   ├── utils/         # Utility functions
│   ├── app.ts         # Express app creation and configuration
│   └── server.ts      # Entry point, HTTP server startup
├── .env               # Environment variables (not committed)
├── .env.example       # Example environment variables
├── .eslintrc.js       # ESLint configuration
├── .gitignore         # Git ignored files
├── package.json       # npm dependencies and scripts
├── tsconfig.json      # TypeScript configuration
└── README.md          # This file
```

### Configuration

#### Environment Variables

Copy `.env.example` to `.env` and fill in the necessary values. Typical variables are:

```env
# Port the server listens on
PORT=3001

# MongoDB connection URI (adjust according to your configuration)
DATABASE_URL=mongodb://mongoadmin:secret@mongodb:27017/fmcompta_db?authSource=admin

# Secret for signing and verifying JWTs
JWT_SECRET=YOUR_VERY_STRONG_JWT_SECRET

# Allowed origins for CORS requests (comma-separated)
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8081

# Runtime environment
NODE_ENV=development
```

### Local Development

1. **Prerequisites:** Node.js, npm/yarn, MongoDB (local or Docker).
2. **Clone:** `git clone https://gitlab.com/ROLANDsebastien/fm-compta-consulting-backend.git`
3. **Navigate:** `cd fm-compta-consulting-backend`
4. **Install:** `npm install`
5. **Configure:** Create and configure your `.env` file.
6. **Run:** `npm run dev` (uses `ts-node-dev` for auto-restart).

### Available Scripts

- `npm run dev`: Runs the server in development mode with auto-restart.
- `npm run build`: Compiles TypeScript code to JavaScript in the `dist` folder.
- `npm start`: Runs the server in production mode from compiled code in `dist`.
- `npm run lint`: Checks code with ESLint.

### CI/CD

This project is integrated into the Jenkins pipeline of the `fm-compta-docker` repository.

- **Docker Image:** Built via `Dockerfile` and pushed to Docker Hub.
- **Deployment:** Deployed by Jenkins using `docker-compose-apps.yml`.

## Database - MongoDB

Configuration and scripts for the MongoDB database of the accounting application. This module manages data persistence and ensures integrity.

### Project Structure

```
database/
├── init-scripts/     # Initialization and migration scripts
│   ├── collections/  # Collection creation
│   ├── indexes/     # Index creation
│   └── seed/        # Test data
├── schemas/         # MongoDB schemas
├── migrations/      # Migration scripts
└── Dockerfile      # Docker configuration for MongoDB
```

### MongoDB Configuration

#### Environment Variables

The following variables are used for MongoDB configuration:

```env
MONGODB_URI=mongodb://localhost:27017/compta_db
MONGODB_USER=admin
MONGODB_PASSWORD=your_password
MONGODB_AUTH_DB=admin
MONGODB_REPLICA_SET=rs0
```

### Collections

#### Transactions
- Storage of financial transactions
- Index on date and transaction type
- Data validation with Mongoose
- Schema:
  ```typescript
  {
    date: Date,
    amount: Number,
    type: String,
    category: String,
    description: String,
    userId: ObjectId
  }
  ```

#### Users
- User and role management
- Index on email
- Password hashing
- Schema:
  ```typescript
  {
    email: String,
    password: String,
    role: String,
    createdAt: Date,
    lastLogin: Date
  }
  ```

#### Categories
- Transaction classification
- Hierarchical structure
- Index on name
- Schema:
  ```typescript
  {
    name: String,
    parentId: ObjectId,
    type: String,
    color: String
  }
  ```

### Available Scripts

#### Database Initialization

```bash
# Create database and collections
npm run db:init

# Create indexes
npm run db:indexes

# Insert test data
npm run db:seed
```

#### Maintenance

```bash
# Backup database
npm run db:backup

# Restore database
npm run db:restore

# Check integrity
npm run db:check

# Clean data
npm run db:cleanup
```

### Best Practices

#### Indexing
- Index on frequently searched fields
- Composite indexes for complex queries
- Partial indexes to optimize performance
- TTL indexes for temporary data

#### Security
- Required authentication
- Data validation
- Input sanitization
- Encryption of sensitive data
- Role and permission management

#### Performance
- Query limitation
- Result pagination
- Optimized aggregation
- Caching of frequent queries
- Performance monitoring

### Backup and Restoration

#### Automatic Backup
- Daily backup
- Backup rotation
- Data compression
- Secure storage
- Backup verification

#### Restoration Procedure
1. Stop the service
2. Restore data
3. Verify integrity
4. Restart service
5. Validate data

### Monitoring

#### Metrics
- Request rate
- Response time
- Memory usage
- Disk space
- Active connections

#### Alerts
- Connection errors
- Degraded performance
- Low disk space
- Replication lag
- Validation errors

#### Logs
- Audit logs
- Error logs
- Performance logs
- Security logs

## Frontend Application

This is the Next.js frontend application for FM Compta Consulting.

### Development

1. **Prerequisites:** Node.js (check version compatibility, e.g., v18+ or v20+ depending on project configuration) and npm/yarn.
2. **Clone Repository:** `git clone https://gitlab.com/ROLANDsebastien/fm-compta-consulting-frontend.git`
3. **Navigate:** `cd fm-compta-consulting-frontend`
4. **Install Dependencies:** `npm install` (or `yarn install`)
5. **Environment Variables:** Create a `.env.local` file based on `.env.example` (if exists) or define necessary variables like `NEXTAUTH_URL`, `NEXTAUTH_SECRET`, `JWT_SECRET`, `NEXT_PUBLIC_API_URL` (e.g., `http://localhost:5000` if backend is running locally).
6. **Start Development Server:** `npm run dev`
7. **Access:** Open `http://localhost:3000` (or configured port).

### Production Build

1. Ensure all dependencies are installed: `npm install`
2. Run build command: `npm run build`
3. The optimized production build will be in the `.next` folder.
4. To run production build locally: `npm start`

### CI/CD

This project is built, tested, and deployed via the Jenkins pipeline defined in the main `fm-compta-docker` repository.

- **Docker Image:** A Docker image is built from this repository's `Dockerfile` and pushed to Docker Hub.
- **Deployment:** The image is deployed as part of the application stack by the Jenkins pipeline using `docker-compose-apps.yml`.

### Technologies Used

- Next.js (v14 or higher)
- TypeScript
- Tailwind CSS
- NextAuth.js

### Project Structure

```
frontend/
├── public/           # Static files
├── src/
│   ├── components/    # Reusable React components
│   ├── hooks/        # Custom hooks
│   ├── lib/        # Shared utilities and configurations
│   ├── models/       # Data models (if shared)
│   ├── pages/        # Next.js pages (file-based routing)
│   ├── providers/    # React context providers
│   ├── services/     # API call logic
│   └── styles/       # Global CSS/SCSS files or modules
├── .env.local        # Local environment variables (not committed)
├── .env.example      # Example environment variables
├── .eslintrc.json    # ESLint configuration
├── .gitignore        # Git ignored files
├── next.config.js    # Next.js configuration
├── package.json      # npm dependencies and scripts
├── postcss.config.js # PostCSS configuration
├── tailwind.config.js # Tailwind CSS configuration
├── tsconfig.json     # TypeScript configuration
└── README.md         # This file
```

### Environment Variables (Example for `.env.local`)

```env
# Backend API URL for client-side calls
NEXT_PUBLIC_API_URL=http://localhost:5000

# Full frontend URL for NextAuth (important for OAuth redirects and callbacks)
# Use localhost for local development
NEXTAUTH_URL=http://localhost:3000

# Secret for signing NextAuth sessions (generate a strong key)
NEXTAUTH_SECRET=GENERATE_A_STRONG_SECRET_HERE

# Secret to verify JWTs generated by the backend (must match backend)
JWT_SECRET=YOUR_SHARED_JWT_SECRET
```

### Features

#### Authentication
- Secure login with NextAuth.js
- Session management
- Route protection

**Admin Account:** For testing and administrative purposes, use the default admin account: email `admin@fmcompta.be` with password `admin123`. This account has full access to all features and should be changed or disabled in production environments.

#### User Interface
- Responsive design with Tailwind CSS
- Dark/light theme
- Reusable components
- Validated forms

#### Transaction Management
- Transaction creation
- Transaction list
- Filters and search
- Data export

#### Dashboards
- Interactive charts
- Real-time statistics
- Customizable reports
- Key KPIs

#### Performance
- Image optimization with Next.js Image
- Progressive component loading
- API request caching
- Font optimization

### Accessibility

- Screen reader support
- Keyboard navigation
- WCAG-compliant color contrast
- Accessible error and success messages
- Keyboard shortcut support

### Contribution

1. Create a branch for your feature
2. Commit your changes
3. Create a Merge Request

### Best Practices

- Follow React/Next.js code conventions
- Use TypeScript for typing
- Optimize performance
- Maintain accessibility

### Support

For any questions or issues:
1. Consult the documentation
2. Check existing issues
3. Create a new issue if necessary